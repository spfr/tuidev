# ============================================================================
# tmux Configuration - Tokyo Night Theme
# ============================================================================
# Companion multiplexer for Claude agent teams split-pane mode.
# Zellij remains primary for manual workspace layouts.
# ============================================================================

# ============================================================================
# Prefix Key
# ============================================================================

# Use Ctrl+a (ergonomic, familiar from screen)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# ============================================================================
# True Color & Terminal
# ============================================================================

set-option -g default-terminal "tmux-256color"
# Tc: true color support for Ghostty, Alacritty, and compatible terminals
set-option -ga terminal-overrides ",*256col*:Tc"
set-option -ga terminal-overrides ",ghostty:Tc"

# ============================================================================
# General Settings
# ============================================================================

# Mouse support
set-option -g mouse on

# Base index 1 (windows and panes start at 1)
set-option -g base-index 1
set-window-option -g pane-base-index 1

# Renumber windows when one is closed
set-option -g renumber-windows on

# Increase scrollback buffer
set-option -g history-limit 50000

# Reduce escape-time for Neovim
set-option -sg escape-time 10

# Focus events for Neovim autoread
set-option -g focus-events on

# Activity monitoring
set-option -g monitor-activity on
set-option -g visual-activity off

# No bell
set-option -g bell-action none
set-option -g visual-bell off

# ============================================================================
# Vi Mode (matches Neovim muscle memory)
# ============================================================================

set-window-option -g mode-keys vi

bind-key -T copy-mode-vi v   send-keys -X begin-selection
bind-key -T copy-mode-vi y   send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# ============================================================================
# Key Bindings
# ============================================================================

# Pane splits (intuitive | and -)
bind-key | split-window -h -c "#{pane_current_path}"
bind-key - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window in current path
bind-key c new-window -c "#{pane_current_path}"

# Pane navigation: prefix + h/j/k/l (vi-style)
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Pane resize: prefix + H/J/K/L
bind-key H resize-pane -L 5
bind-key J resize-pane -D 5
bind-key K resize-pane -U 5
bind-key L resize-pane -R 5

# Reload config
bind-key r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded"

# ============================================================================
# Tokyo Night Status Bar
# ============================================================================

# Colors
TN_BG="#1a1b26"
TN_BG_DARK="#16161e"
TN_BG_HIGHLIGHT="#292e42"
TN_FG="#c0caf5"
TN_ACCENT="#7aa2f7"
TN_GREEN="#9ece6a"
TN_YELLOW="#e0af68"
TN_RED="#f7768e"
TN_CYAN="#7dcfff"

set-option -g status on
set-option -g status-interval 5
set-option -g status-position bottom
set-option -g status-justify left

# Status bar colors
set-option -g status-style "bg=${TN_BG},fg=${TN_FG}"

# Left: session name
set-option -g status-left-length 30
set-option -g status-left "#[bg=${TN_ACCENT},fg=${TN_BG},bold] #S #[bg=${TN_BG},fg=${TN_ACCENT}] "

# Right: date/time
set-option -g status-right-length 50
set-option -g status-right "#[fg=${TN_BG_HIGHLIGHT}]#[bg=${TN_BG_HIGHLIGHT},fg=${TN_FG}] %H:%M #[bg=${TN_BG_HIGHLIGHT},fg=${TN_ACCENT}]#[bg=${TN_ACCENT},fg=${TN_BG},bold] %d %b "

# Window status
set-window-option -g window-status-format "#[fg=${TN_FG}] #I:#W "
set-window-option -g window-status-current-format "#[bg=${TN_BG_HIGHLIGHT},fg=${TN_ACCENT},bold] #I:#W "
set-window-option -g window-status-activity-style "fg=${TN_YELLOW}"

# Pane borders
set-option -g pane-border-style "fg=${TN_BG_HIGHLIGHT}"
set-option -g pane-active-border-style "fg=${TN_ACCENT}"

# Message style
set-option -g message-style "bg=${TN_BG_HIGHLIGHT},fg=${TN_ACCENT}"
set-option -g message-command-style "bg=${TN_BG_HIGHLIGHT},fg=${TN_FG}"

# Mode (copy mode) highlight
set-window-option -g mode-style "bg=${TN_ACCENT},fg=${TN_BG}"
